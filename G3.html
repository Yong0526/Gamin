<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>第三关 - 躲避陷阱</title>
<style>
body {
  margin: 0;
  font-family: 'Arial', sans-serif;
  text-align: center;
  background: linear-gradient(to bottom, #87CEFA, #1E90FF);
  color: #fff;
}

/* 游戏规则提示 */
#rulesOverlay {
  position: fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.7);
  color:#fff;
  display:flex; flex-direction:column;
  justify-content:center; align-items:center; z-index:999;
}
#rulesOverlay button {
  margin-top:20px; padding:10px 20px;
  font-size:18px; border:none; border-radius:8px;
  cursor:pointer; background:#ff69b4; color:#fff;
}

/* 游戏信息 */
#score { font-size: 18px; margin: 8px 0 2px 0; font-weight: bold; }
#progressContainer { width: 90%; height: 20px; background: rgba(255,255,255,0.3); border-radius: 10px; overflow: hidden; margin: 0 auto 8px; }
#progressBar { width: 0%; height: 100%; background: #ffcc00; transition: width 0.2s ease; }

/* 游戏画布 */
#gameCanvas { border: 2px solid #0073b3; border-radius: 8px; background: rgba(255,255,255,0.8); display: block; margin: 0 auto; touch-action: none; }

/* 控制按钮 */
#controlBtns {
  position: fixed;
  bottom: 10px;
  width: 100%;
  display: flex;
  justify-content: space-evenly;
  padding: 0 20px;
}
#controlBtns button {
  width: 80px;
  height: 40px;
  font-size: 14px;
  border: none;
  border-radius: 8px;
  background: #ff69b4;
  color: #fff;
  cursor: pointer;
}
#controlBtns button:active { background: #ff3385; }

/* 其它按钮 */
#restartBtn, #continueBtn {
  display: none;
  margin: 12px auto;
  padding: 10px 25px;
  font-size: 16px;
  background: #0073b3;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
#restartBtn:active, #continueBtn:active { background: #005a8c; }
</style>
</head>
<body>

<!-- 游戏规则提示 -->
<div id="rulesOverlay">
  <h2>第三关游戏规则</h2>
  <p>控制粉色方块左右躲避下落红色陷阱方块</p>
  <p>躲过 10 个陷阱即可完成第三关</p>
  <button id="startGameBtn">开始游戏</button>
</div>

<!-- 第三关 -->
<div id="score">分数: 0 / 10</div>
<div id="progressContainer"><div id="progressBar"></div></div>
<canvas id="gameCanvas" width="350" height="600"></canvas>

<!-- 控制按钮 -->
<div id="controlBtns">
  <button id="leftBtn">⬅️ 左移</button>
  <button id="rightBtn">➡️ 右移</button>
</div>

<button id="restartBtn">重新开始</button>
<button id="continueBtn">继续第四关</button>

<script>
// ------------------- 第三关 -------------------
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const player = { x:150, y:540, width:50, height:50, color:'#ff69b4', speed:7 };
const traps = [];
let score=0, gameOver=false;
const target=10; // 目标分数改为 10

function spawnTrap(){ 
  const size=50; 
  traps.push({ x:Math.random()*(canvas.width-size), y:-size, width:size, height:size, color:'#ff4444', speed:1.5+Math.random()*2 }); 
}
function drawPlayer(){ ctx.fillStyle=player.color; ctx.fillRect(player.x,player.y,player.width,player.height); }
function drawTraps(){ traps.forEach(trap=>{ ctx.fillStyle=trap.color; ctx.beginPath(); ctx.arc(trap.x+trap.width/2, trap.y+trap.height/2, trap.width/2,0,Math.PI*2); ctx.fill(); }); }
function updateTraps(){
  traps.forEach((trap,index)=>{
    trap.y+=trap.speed;
    if(trap.x<player.x+player.width && trap.x+trap.width>player.x &&
       trap.y<player.y+player.height && trap.y+trap.height>player.y) gameOver=true;
    if(trap.y>canvas.height){
      traps.splice(index,1);
      score++;
      document.getElementById('score').innerText=`分数: ${score} / ${target}`;
      document.getElementById('progressBar').style.width=`${(score/target)*100}%`;
      if(score>=target){ gameOver=true; setTimeout(()=>{ document.getElementById('continueBtn').style.display='block'; },100); }
    }
  });
}
function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); drawPlayer(); drawTraps(); }
function gameLoop(){ if(!gameOver){ updateTraps(); draw(); requestAnimationFrame(gameLoop); } else{ document.getElementById('restartBtn').style.display='block'; if(score<target) setTimeout(()=>alert('游戏失败！你的分数:'+score),50);} }
let keys={};
document.addEventListener('keydown',e=>keys[e.key]=true);
document.addEventListener('keyup',e=>keys[e.key]=false);
function movePlayer(){ 
  if(keys['ArrowLeft']&&player.x>0)player.x-=player.speed; 
  if(keys['ArrowRight']&&player.x+player.width<canvas.width)player.x+=player.speed; 
  requestAnimationFrame(movePlayer); 
}
movePlayer();
setInterval(()=>{if(!gameOver) spawnTrap();},1200); // 陷阱生成间隔放慢
document.getElementById('restartBtn').addEventListener('click',()=>{
  traps.length=0; score=0; gameOver=false; player.x=150;
  document.getElementById('score').innerText=`分数: ${score} / ${target}`;
  document.getElementById('progressBar').style.width='0%';
  document.getElementById('restartBtn').style.display='none';
  gameLoop();
});
document.getElementById('startGameBtn').addEventListener('click',()=>{ document.getElementById('rulesOverlay').style.display='none'; gameLoop(); });

// 按钮操作
document.getElementById("leftBtn").addEventListener("click", ()=>{
  if(player.x > 0) player.x -= player.speed;
});
document.getElementById("rightBtn").addEventListener("click", ()=>{
  if(player.x + player.width < canvas.width) player.x += player.speed;
});
</script>
</body>
</html>


